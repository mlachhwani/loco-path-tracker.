<!DOCTYPE html>
<html>
<head>
    <title>SECR AUDIT TOOL - FINAL FIX</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', Arial; display: flex; height: 100vh; background: #f0f2f5; }
        #sidebar { width: 320px; background: #002f6c; color: white; padding: 20px; z-index: 1000; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
        #map { flex-grow: 1; background: #ddd; position: relative; }
        .speed-tag { background: white; border: 1px solid #d32f2f; color: #d32f2f; font-size: 10px; font-weight: bold; padding: 1px 3px; border-radius: 2px; text-align: center; }
        select, input, button { width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 5px; border: none; font-weight: bold; box-sizing: border-box; }
        button { color: white; cursor: pointer; font-size: 14px; text-transform: uppercase; }
        #speed-dash {
            position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.85);
            color: #00ff00; padding: 15px; border-radius: 10px; z-index: 2000; text-align: center; min-width: 140px;
        }
    </style>
</head>
<body>

<div id="speed-dash">
    <div style="font-size: 11px; color: #ccc;">LIVE SPEED</div>
    <div id="live-speed" style="font-size: 32px; font-weight: bold;">00.0</div>
    <div id="live-time" style="font-size: 14px; color: #00ff00;">--:--:--</div>
</div>

<div id="sidebar">
    <h2 style="border-bottom: 2px solid #ffc107; padding-bottom: 10px;">SECR AUDIT</h2>
    <label>FROM STATION</label><select id="s_from"></select>
    <label>TO STATION</label><select id="s_to"></select>
    <label>RTIS DATA (CSV)</label><input type="file" id="csv_file">
    
    <button onclick="generateLiveMap()" style="background: #28a745;">1. Generate Map</button>
    <button onclick="downloadExcelAudit()" style="background: #007bff;">2. Download Excel</button>
    <button onclick="saveInteractiveWebReport()" style="background: #ffc107; color: #000;">3. Save Web Report</button>
    
    <div id="log" style="font-size:12px; margin-top:10px; color:#ffc107;">Ready...</div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="mapping.js"></script>
<script src="report.js"></script>

</body>
</html>
